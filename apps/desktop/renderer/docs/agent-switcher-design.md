# Agent 对话页 · 智能体切换设计方案

## 一、目标

- 在**输入框附近**提供**智能体选择**，选中后发送第一条消息时用该智能体创建 Session 并开始对话。
- 布局：**专业、简洁、现代**，不抢输入框焦点，又清晰可见。

---

## 二、布局方案（推荐）

### 2.1 结构示意

```
┌─────────────────────────────────────────────────────────────────┐
│  [ 消息列表 / 空状态 ]                                            │
├─────────────────────────────────────────────────────────────────┤
│  ┌─ 输入区域 (input-area) ─────────────────────────────────────┐ │
│  │  ┌─ 智能体选择条（单行，可选）─────────────────────────────┐ │ │
│  │  │  🤖 主智能体  ▼   （或：与当前会话绑定的智能体名）        │ │ │
│  │  └────────────────────────────────────────────────────────┘ │ │
│  │  ┌─ 输入框 + 发送按钮 ─────────────────────────────────────┐ │ │
│  │  │  输入消息… (Shift+Enter 换行)                      [➤]  │ │ │
│  │  └────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

- **智能体选择条**：在输入框**正上方**、同一块 `input-area` 内，与输入框视觉一体（同背景、圆角延续），形成「上：选智能体 / 下：输入+发送」的清晰分区。

### 2.2 两种状态

| 状态 | 展示 | 交互 |
|------|------|------|
| **无当前会话** | 显示「选择智能体」控件：当前选中项（如「主智能体」）+ 下拉箭头；点击展开下拉列表（智能体列表来自 `/agent-config`）。 | 用户选一个智能体 → 输入内容 → 发送 → 用**所选 agentId** 调用 `createSession({ agentId, title })`，再发消息，建立 Session。 |
| **有当前会话** | 显示当前会话所属智能体名称（只读），可带小图标；样式略弱化（如次要文字色），表示“当前对话用的是这个智能体”。 | 可选：右侧提供「换一个智能体」入口（如小链接/图标），点击后清空当前会话并回到「无会话」状态，再选新智能体发第一条消息。 |

### 2.3 视觉规范（与现有风格统一）

- **选择条**  
  - 高度约 36–40px，与输入框同宽，上下留少量间距（如 8–12px）。  
  - 背景与输入区域一致（如 `var(--color-bg-secondary)`），边框用 `var(--glass-border)`，圆角与输入框统一（如 `var(--radius-md)`）。  
- **当前选中展示**  
  - 左侧：小图标（如 🤖 或 SVG 机器人/头像）。  
  - 中间：智能体名称（主智能体 / 自定义名）。  
  - 右侧：下拉箭头（无会话时可点击），有会话时可隐藏或改为「换智能体」入口。  
- **下拉列表**  
  - 使用现有 card-glass / 浮层样式，带轻微阴影与圆角；列表项 hover 高亮，选中项可打勾或加粗。  
  - 列表过长时间可滚动，最大高度约 280px。  

这样**不改变现有输入框与发送按钮的布局**，只在输入区顶部增加一行，逻辑清晰、易实现。

---

## 三、交互流程

1. 用户进入 Agent 对话页，**无当前会话**时：  
   - 看到输入区上方「智能体」选择条，默认选中「主智能体」（或上次选择的智能体，若可持久化）。  
2. 用户可点击选择条，从下拉列表中**切换智能体**。  
3. 用户输入内容并**发送第一条消息**：  
   - 用当前选中的 `agentId` 调用 `createSession({ agentId, title: message.slice(0,50) })`；  
   - 再按现有逻辑发送消息、建立 Session、更新路由与左侧会话列表。  
4. **已有会话时**：  
   - 选择条仅展示当前会话的智能体名称（只读）；  
   - 可选提供「换智能体」：清空当前会话 → 回到步骤 1，再选智能体并发第一条消息。

与现有逻辑兼容：**仍为“发第一条消息时建 Session”**，只是建 Session 时使用的 `agentId` 来自选择条。

---

## 四、数据与 API

- **智能体列表**：已有 `agentConfigAPI.listAgents()`，直接复用。  
- **创建会话**：已有 `createSession({ agentId, workspace?, title? })`，首次发送时传入当前选中的 `agentId` 即可。  
- **可选持久化**：在 localStorage 存 `openbot.lastSelectedAgentId`，下次进入无会话时默认选中该智能体。

---

## 五、小结

- **位置**：输入框正上方、同一输入区域内的一行「智能体选择条」。  
- **无会话**：可点击下拉选择智能体，发送第一条消息时用所选智能体建 Session。  
- **有会话**：仅展示当前智能体名；可选「换智能体」回到无会话状态再选再发。  
- **视觉**：与现有 input-area 风格统一，简洁、专业、不喧宾夺主。

若认可该方案，可按此在 `AgentChat.vue` 中增加选择条组件与 `createSession` 的 `agentId` 传入逻辑，并视需要补 i18n 与「换智能体」入口。
